"use strict";(self.webpackChunkkasa=self.webpackChunkkasa||[]).push([[20],{7020:(e,s,a)=>{a.r(s),a.d(s,{default:()=>c});var n=a(5043),o=a(9367),r=a(5475),t=a(5187),i=a(579);const c=()=>{const[e,s]=(0,n.useState)([]),[a,c]=(0,n.useState)(!0),[l,d]=(0,n.useState)(""),{user:h}=(0,t.As)();(0,n.useEffect)(()=>{if(!h)return void c(!1);(async()=>{c(!0),d("");try{const e=localStorage.getItem("token"),a=await fetch("".concat("https://kasa-backend.onrender.com/api","/my-bookings"),{headers:{Authorization:"Bearer ".concat(e)}});if(!a.ok)throw new Error("Failed to fetch bookings");const n=await a.json();s(n)}catch(e){d(e.message)}finally{c(!1)}})()},[h]);return a?(0,i.jsx)("div",{children:"Loading bookings..."}):h?l?(0,i.jsxs)("div",{children:["Error: ",l]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(o.mg,{children:[(0,i.jsx)("title",{children:"Mes r\xe9servations - Kasa"}),(0,i.jsx)("meta",{name:"description",content:"Consultez et g\xe9rez vos r\xe9servations sur Kasa. Retrouvez les d\xe9tails de vos s\xe9jours pass\xe9s et \xe0 venir."})]}),(0,i.jsxs)("main",{className:"kasa__wrapper fade-in",children:[(0,i.jsx)("h1",{children:"Mes r\xe9servations"}),(0,i.jsx)("p",{children:"Retrouvez ici l'historique de vos s\xe9jours."}),(0,i.jsx)("div",{className:"bookings-container",children:e.map(e=>(0,i.jsx)("div",{className:"booking-card",children:e.house?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.N_,{to:"/house/".concat(e.house.id),children:(0,i.jsx)("img",{src:e.house.cover,alt:e.house.title,className:"booking-card__image"})}),(0,i.jsxs)("div",{className:"booking-card__info",children:[(0,i.jsx)(r.N_,{to:"/house/".concat(e.house.id),className:"booking-card__title-link",children:(0,i.jsx)("h2",{children:e.house.title})}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Du:"})," ",new Date(e.startDate).toLocaleDateString()]}),(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Au:"})," ",new Date(e.endDate).toLocaleDateString()]}),(0,i.jsx)("div",{className:"booking-card__actions",children:(0,i.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\xcates-vous s\xfbr de vouloir annuler cette r\xe9servation ?")){d("");try{const a=localStorage.getItem("token"),n=await fetch("".concat("https://kasa-backend.onrender.com/api","/bookings/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(a)}});if(!n.ok){const e=await n.json().catch(()=>({}));throw new Error(e.message||"Impossible d'annuler la r\xe9servation.")}s(s=>s.filter(s=>s.id!==e))}catch(a){d(a.message)}}})(e.id),className:"booking-card__cancel-btn",children:"Annuler la r\xe9servation"})})]})]}):(0,i.jsx)("p",{children:"Informations sur le logement non disponibles."})},e.id))})]})]}):(0,i.jsxs)("main",{className:"kasa__wrapper fade-in kasa__main-container",children:[(0,i.jsx)("h1",{children:"Mes r\xe9servations"}),(0,i.jsxs)("p",{children:["Veuillez vous ",(0,i.jsx)(r.N_,{to:"/login",children:"connecter"})," pour voir vos r\xe9servations."]})]})}}}]);
//# sourceMappingURL=20.0303eaef.chunk.js.map